var _ = require("underscore");

var flags = function(){

  // Flags set with these values should be interpreted as false.
  this.falsehoods = ["FALSE", "false"];
  this.truths     = ["TRUE", "true"];

  // Get all process arguments and parse out those formatted
  // with double-dash flags.
  this.args = process.argv.join(" ").match(/--([^\s]+)/g);

  // Extract key values from each flag, return object.
  this.parse = function(flag){
    var pair = flag.replace("--", "").split("=")
    if(pair.length == 1){
      return { key: pair[0] }
    }
    else {
      return { key: pair[0], value: pair[1] }
    }
  };

  // Itterate through all arguments and apply
  // the flag parser.
  this.list = _.map(this.args, this.parse, this);

  // Method for checking or getting the value
  // of a single flag.
  this.get = function(key){
    var check = _.find(this.list, function(o){
      if(key == o.key){
        return o;
      }
    });
    if(!check || _.indexOf(this.falsehoods, check.value) !== -1){
      return false;
    } else if(check && _.indexOf(this.truths, check.value) !== -1){
      return true
    } else if(check && check.value === "0"){
      return 0;
    } else if(check && check.value === "1"){
      return 1;
    } else if(!check.value){
      return true;
    } else {
      return check.value;
    }
  };

  return this;
};

module.exports = new flags();
